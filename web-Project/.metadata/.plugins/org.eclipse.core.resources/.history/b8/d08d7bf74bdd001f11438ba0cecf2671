package dao;

import beans.*;
import java.sql.*;
import java.util.*;
import javax.naming.*;

public class PmgetDao extends Dao {

	public void insert(PmgetBean pgb,PmBean pb)
			throws NamingException,SQLException{
//		副問い合わせ:pmname,pmpassからpmidを取得
		String sql1 ="(SELECT pmid FROM pmaster WHERE pmname=? AND pmpass=?)";
//		主問い合わせ:INSERT文
		String sql = "INSERT INTO pmget"
					+"(pmid,pid,nickname,gen)"
					+"VALUES("+sql1+",?,?,?)";
		PreparedStatement stmt = prepareStatement(sql);
//		バインド(副問い合わせ分２つ+主問い合わせ3つ)
		stmt.setString(1, pb.getPmname());
		stmt.setString(2, pb.getPmpass());
		stmt.setInt(3, pgb.getPid());
		stmt.setString(4, pgb.getNickname());
		stmt.setString(5, pgb.getGen());
		stmt.executeUpdate();
	}
	public List<PmgetBean> select(PmBean pb)
			throws NamingException,SQLException{
		String sql1 = "(SELECT pmid FROM pmaster WHERE pmname=? AND PMPASS=?)";
		String sql = "SELECT * FROM pmget pm"
					+ "JOIN pokemon p ON pm.pid=p.pid"
					+" JOIn ptype pt ON p.ptid=pt.ptid WHERE pmid="
					+ sql1;
		PreparedStatement stmt = prepareStatement(sql);
		stmt.setString(1, pb.getPmname());
		stmt.setString(2, pb.getPmpass());
		List<PmgetBean> list =new ArrayList<>();
		ResultSet rs = stmt.executeQuery();
		while(rs.next()){
			Pmgetbean pgb = new pmgetBean();
			pgb.setGen(rs.getString("gen"));
			pgb.setNickname(rs.getString("Nickname"));
			pgb.setPid(rs.getInt("pid"));
			pgb.setPimg(rs.getString("pimg"));
			pgb.setPmid(rs.getInt("pmid"));
			pgb.setPname(rs.getString("pname"));
			pgb.setPtimg(rs.getString("ptimg"));
			pgb.setPtname(rs.getString("ptname"));
		}
	}
}
