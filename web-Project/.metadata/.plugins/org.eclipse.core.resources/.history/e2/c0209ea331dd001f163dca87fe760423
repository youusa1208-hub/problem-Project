package dao;

import beans.PmBean;
import java.sql.*;
import javax.naming.*;

public class PmDao extends Dao {

//	引数の名前とパスワードに一致するデータがある場合→PmBeanのインスタンスを返す
//					一致するデータがない場合→nullを返す
	public PmBean search(String n,String p)
			throws NamingException,SQLException{
		String sql = "SELECT * FROM pmaster"
					+"WHERE pmname=? AND pmpass?";
		PreparedStatement stmt = prepareStatement(sql);
		stmt.setString(1, n);
		stmt.setString(2, p);
		ResultSet rs = stmt.executeQuery();
		PmBean pb = null;
		if(rs.next()){
//			データがあるので、インスタンスを生成
			pb = new PmBean();
			pb.setPmid(rs.getInt("pmid"));
			pb.setPmname(rs.getString("pmname"));
			pb.setPmpass(rs.getString("pmpass"));
		}
		return pb;
	}
	
//	データ登録処理
	public void insert(String n,String p)
			throws NamingException,SQLException{
		String sql1 ="(SELECT MAX(pmid)+1 FROM pmaster)";
		String sql ="INSERT INTO pmaster"
					+"(pmid,pmname,pmpass)"
					+"VALUES("+sql1+",?,?)";
		PreparedStatement stmt = prepareStatement(sql);
		stmt.setString(1, n);
		stmt.setString(2, p);
		stmt.executeUpdate();
	}
	
//	同じ名前で登録できないようにするため、名前が登録済みかチェック
//	名前を指定→登録済み→true
//			未登録→false
	public boolean existsData(String n)
			throws NamingException,SQLException{
		String sql = "SELECT * FROM pmaster WHERE pmname=?";
		PreparedStatement stmt = prepareStatement(sql);
		stmt.setString(1, n);
		ResultSet rs = stmt.executeQuery();
		if(rs.next()){
			return true;
		}
		return false;
	}
}
